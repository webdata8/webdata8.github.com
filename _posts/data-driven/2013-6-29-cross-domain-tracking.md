---
layout: post
title: 跨域名数据跟踪在网站分析工具中，属GA的是最麻烦的
description:
heading: 跨域名数据跟踪在网站分析工具中，属GA的是最麻烦的
category: data-driven
publish: true
published: true
datePublished: 2013-6-29T00:00:00.000Z
dateModified:
date: 2013-6-29
---

跨域名跟踪一直是在网站分析工作中，做跟踪一个棘手的问题。特别是使用的网站分析工具不同，跟踪的手法也就不一样。就对比GA，Omniture和百度统计来说，Google Analytics是最复杂的也是最麻烦的，下面就通过实际工作遇到的例子，来和大家分享下。

一般来说，跨域名跟踪就是两个不同的域名之间的流量跟踪，比如a.com与b.com。跨域名跟踪的用意就是希望ab两个域名的流量能建立一个连接，比如从百度搜索某一个关键词来到a.com，然后点击一个报价链接到了b，虽然ab两个站点都是你所拥有，但是这时候在a的报表里面记录的是搜索流量，而b的这个流量则被认为a的推荐流量了，一般来说，如果是一个购物流程经常会有跨域名的情况，有可能是跨子域名。而有时候，很多站点做了一群的站点来导入流量，希望有一个报表包是用来跟踪所有站点之间的点击行为，这就是需要到跨域名跟踪了。

先来说简单的情况，对于Omniture，只要设置对应的域名建立在同一个报表包，就可以所有域名当做相同一个站点了，只需要在var s_account声明，并加入对应域名的底部跟踪代码就可以了。比如在a和b站点添加一个相同的var s_account就可以了。同时Sitecatalyst有一个可以排除自身推介的后台功能。而对于百度统计，直接在后台加入跨域的URL就可以了。

前文说到，复杂的是GA的情况。建议大家看看<a href="https://support.google.com/analytics/answer/1034342?hl=zh-Hans" target="_blank">GA的官方文档</a>，里面介绍得很清楚了。简单来说，就是要考虑出从域名a到域名b，以及域名b到域名a之间的通道，需要保持GATC的cookie不变就可以。比如域名a到域名b有一个在a.com的链接，当从百度搜索过来后，点击该链接，此时到达b之后，URL会出现一串带有GATC的cookie，也就是GA需要当做该流量仍未百度搜索流量，而并非直流或者a的推介流量。同理，对于form的过渡，也需要保持这样的跟踪形式。

而常见的问题有：

1.请勿在a域名的跟踪代码有setdomianname为b.com，这样的话很多流量将会缺失。并且那个setAllowHash在GA开发者文档里面已经声明，可以弃用了。

2.当a.com所有出链都是到b.com，并且没有跨域名跟踪，并且该页面没有event tracking那么a.com在GA报表里面的跳出率都会为100%，，那么停留时间为0.

3.当在跨域名跟踪的时候，在执行form中的onsubmit属性时候，需要注意form里面是否有用到onclick加上submit方法，因为在HTML中这些有可能出现submit方法执行后onsumit没有发送的情况，这个可以利用debug工具查询。

4.当在跨域名跟踪时候，对于a.com中的form的目标页面（一般是action里面）如果用绝对路径那就没有问题了，如果用相对路径或者#然后跳转到b.com的某一目标页面，那这样就需要将GATC的cookie传递到最终目标页面。此时真正的跨域是action的URL跳转到b.com的这个情形，和form的button点击已经没有关系了。但这种情况比较少，一般是站点的业务需求或历史代码结构导致的。正常来说，目标页面直接放绝对路径的就OK了。

5.如果需要做测试的话，可以在自己站点的本地搭建工程来创建多个不同域名站点来做测试，同时只要将IP在C盘的host文件自定义你想要的域名就可以了。如果你有自己的实际域名站点，那就更好了。

注：所有文章及图片版权归网站数据吧（WebData8.com）所有。转载请注明出处“<a href="/">Webdata8网站分析</a>”。
